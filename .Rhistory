scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/counts.png")
#changes
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, change, color = Type)) +
scale_y_continuous("Change relative to day before") +
scale_x_date(date_breaks = "1 day") +
geom_line() +
ggtitle("Danish COVID-19 hospital data: change in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/change.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
scale_y_continuous("Percent change relative to day before", labels = scales::percent) +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = log10) +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
View(d)
d = d_orig %>%
#drop NA
miss_filter() %>%
#gather to long format
gather(key = region, value = number, `Region Nordjylland`:`Hele landet`) %>%
#fix date
mutate(
Date = (Date + " 2020") %>% parse_date(format = "%d. %B %Y", locale = locale("da"))
)
#add growth values
#to do so, we need subgroup
d = d %>%
#sort by date first
arrange(Date) %>%
#then subgroup to each type and region
plyr::ddply(c("region", "Type"), function(dd) {
#add growth
dd %>%
mutate(
change = number - lag(number),
growth = change / lag(number)
)
}) %>%
miss_filter()
View(d)
#last update
(last_update = format(max(d$Date),'%A, %d. %B %Y'))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/counts.png")
#changes
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, change, color = Type)) +
scale_y_continuous("Change relative to day before") +
scale_x_date(date_breaks = "1 day") +
geom_line() +
ggtitle("Danish COVID-19 hospital data: change in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/change.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
View(d)
#add growth values
#to do so, we need subgroup
d = d %>%
#sort by date first
arrange(Date) %>%
#then subgroup to each type and region
plyr::ddply(c("region", "Type"), function(dd) {
#add growth
dd %>%
mutate(
change = number - lag(number),
growth = change / lag(number)
)
})
d = d_orig %>%
#drop NA
miss_filter() %>%
#gather to long format
gather(key = region, value = number, `Region Nordjylland`:`Hele landet`) %>%
#fix date
mutate(
Date = (Date + " 2020") %>% parse_date(format = "%d. %B %Y", locale = locale("da"))
)
#add growth values
#to do so, we need subgroup
d = d %>%
#sort by date first
arrange(Date) %>%
#then subgroup to each type and region
plyr::ddply(c("region", "Type"), function(dd) {
#add growth
dd %>%
mutate(
change = number - lag(number),
growth = change / lag(number)
)
})
View(d)
# Chunk 1
options(digits = 2)
library(pacman)
p_load(kirkegaard, googlesheets4, lubridate)
theme_set(theme_bw())
# Chunk 2
#read sheet
d_orig = read_sheet("https://docs.google.com/spreadsheets/d/1o-2vsjaAsPzypZCC-rXplY8WVBO8kMsCpo6Or4Ek_xI/edit#gid=0", sheet = 1)
# Chunk 1
options(digits = 2)
library(pacman)
p_load(kirkegaard, googlesheets4, lubridate)
theme_set(theme_bw())
# Chunk 2
#read sheet
googlesheets4::sheets_auth("the.dfx@gmail.com")
d_orig = read_sheet("https://docs.google.com/spreadsheets/d/1o-2vsjaAsPzypZCC-rXplY8WVBO8kMsCpo6Or4Ek_xI/edit#gid=0", sheet = 1)
#recode
#month names recode
da_months = locale(date_names = "da") %>% .$date_names %>% .$mon
en_months = locale(date_names = "en") %>% .$date_names %>% .$mon
d = d_orig %>%
#drop NA
miss_filter() %>%
#gather to long format
gather(key = region, value = number, `Region Nordjylland`:`Hele landet`) %>%
#fix date
mutate(
Date = (Date + " 2020") %>% parse_date(format = "%d. %B %Y", locale = locale("da"))
)
#add growth values
#to do so, we need subgroup
d = d %>%
#sort by date first
arrange(Date) %>%
#then subgroup to each type and region
plyr::ddply(c("region", "Type"), function(dd) {
#add growth
dd %>%
mutate(
change = number - lag(number),
growth = change / lag(number)
)
})
#last update
(last_update = format(max(d$Date),'%A, %d. %B %Y'))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day") +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/counts.png")
#changes
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, change, color = Type)) +
scale_y_continuous("Change relative to day before") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
geom_line() +
ggtitle("Danish COVID-19 hospital data: change in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/change.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_label(aes(label = growth)) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_label(aes(label = format_digits(growth))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_label(aes(label = scales::percent(growth))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_label(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
p_load(kirkegaard, googlesheets4, lubridate, ggrepel)
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_label_repel(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
geom_label_repel(aes(label = number)) +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
geom_label_text(aes(label = number)) +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
geom_text_repel(aes(label = number)) +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
geom_text_repel(aes(label = number)) +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/counts.png")
#changes
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, change, color = Type)) +
scale_y_continuous("Change relative to day before") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
geom_line() +
geom_text_repel(aes(label = change)) +
ggtitle("Danish COVID-19 hospital data: change in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/change.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
# Chunk 1
options(digits = 2)
library(pacman)
p_load(kirkegaard, googlesheets4, lubridate, ggrepel)
theme_set(theme_bw())
# Chunk 2
#read sheet
googlesheets4::sheets_auth("the.dfx@gmail.com")
d_orig = read_sheet("https://docs.google.com/spreadsheets/d/1o-2vsjaAsPzypZCC-rXplY8WVBO8kMsCpo6Or4Ek_xI/edit#gid=0", sheet = 1)
#recode
d = d_orig %>%
#drop NA
miss_filter() %>%
#gather to long format
gather(key = region, value = number, `Region Nordjylland`:`Hele landet`) %>%
#fix date
mutate(
Date = (Date + " 2020") %>% parse_date(format = "%d. %B %Y", locale = locale("da"))
)
#add growth values
#to do so, we need subgroup
d = d %>%
#sort by date first
arrange(Date) %>%
#then subgroup to each type and region
plyr::ddply(c("region", "Type"), function(dd) {
#add growth
dd %>%
mutate(
change = number - lag(number),
growth = change / lag(number)
)
})
# Chunk 3
#last update
(last_update = format(max(d$Date),'%A, %d. %B %Y'))
#counts
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, number, color = Type)) +
geom_line() +
geom_text_repel(aes(label = number)) +
scale_y_continuous("Count of persons") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/counts.png")
#changes
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, change, color = Type)) +
scale_y_continuous("Change relative to day before") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
geom_line() +
geom_text_repel(aes(label = change)) +
ggtitle("Danish COVID-19 hospital data: change in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/change.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
View(d)
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 3))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 4))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 3))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 3))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
#growth
d %>%
filter(region == "Hele landet") %>%
#gather
ggplot(aes(Date, growth, color = Type)) +
geom_line() +
geom_text_repel(aes(label = scales::percent(growth, accuracy = 2))) +
scale_y_continuous("Percent change relative to day before", labels = scales::percent, trans = "log10") +
scale_x_date(date_breaks = "1 day", guide = guide_axis(n.dodge = 2)) +
ggtitle("Danish COVID-19 hospital data: growth in % in number of hospitalized by type of care",
str_glue("Data updated as of {last_update}"))
GG_save("figs/growth.png")
